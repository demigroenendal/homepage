<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Demi Groenendal</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">

<style>
html, body {
    margin: 0; width: 100%; height: 100%;
    font-family: 'Montserrat', sans-serif;
    background-color: #000;
    color: #fff;
    scroll-behavior: smooth; overflow-x: hidden;
    transition: background-color 0.8s ease;
    overscroll-behavior-y: contain; 
}
body.stop-anim { animation-play-state: paused !important; }

/* SFONDO CODICE / 3D */
#canvasBG {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    z-index: -1; opacity: 0.4; pointer-events: none;
}

/* NAVBAR */
.navbar {
    position: fixed;
    top: 0; right: 0; left: 0;
    z-index: 10001; 
    display: flex;
    justify-content: center;
    gap: 25px;
    padding: 20px 40px;
    transition: opacity 0.4s ease, visibility 0.4s ease;
    background: transparent;
}
.navbar.hidden { opacity: 0; visibility: hidden; pointer-events: none; }
.navbar a { text-decoration: none; color: #fff; font-size: 11px; letter-spacing: 3px; font-weight: 700; text-transform: uppercase; }

/* BARRA SFONDO SFOCATO */
.scroll-overlay, .about-bar-bg {
    position: fixed;
    top: 0; left: 0;
    width: 100%;
    height: 60px;
    background: rgba(0, 0, 0, 0.4);
    backdrop-filter: blur(15px);
    -webkit-backdrop-filter: blur(15px);
    pointer-events: none;
    z-index: 9998;
    opacity: 1;
    transition: opacity 0.4s ease;
}

.about-bar-bg {
    z-index: 10001;
}

/* LOGO SFONDO */
#bgLogo {
    position: fixed; top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    width: clamp(150px, 35vw, 500px); 
    opacity: 0.15;
    z-index: 0; pointer-events: none;
    display: flex; justify-content: center; align-items: center;
}
#bgLogo img {
    width: 100%; height: auto; filter: brightness(0) invert(1);
}

#p3Canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 5000; display: none; }
#p3Canvas.active { display: block; }

/* OVERLAY ABOUT ME */
#aboutOverlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: #000; z-index: 10000; 
    display: none;
    flex-direction: column; justify-content: center; align-items: center;
    overflow-y: auto;
}
#aboutOverlay.active { display: flex; }

.about-links { 
    display: flex; flex-direction: column; gap: 35px; text-align: center; width: 100%; align-items: center; padding: 120px 0; 
}
.about-links a { 
    color: #fff; text-decoration: none; font-size: clamp(18px, 5vw, 24px); 
    font-weight: 700; letter-spacing: 8px; text-transform: uppercase; 
    transition: 0.4s; 
}
.about-links a:hover { letter-spacing: 12px; opacity: 0.5; }

/* GALLERIE */
#photoGallery, #videoGallery, #graphicGallery {
    display: none; flex-direction: column; gap: 20px; margin-top: 30px;
    opacity: 0; transition: opacity 0.5s ease;
}
#photoGallery.active, #videoGallery.active, #graphicGallery.active { display: flex; opacity: 1; }

.photo-rect, .video-rect, .graphic-rect { 
    display: flex; 
    gap: 20px; 
    justify-content: center; 
    flex-direction: row; 
    flex-wrap: wrap; 
}

.media-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;
    max-width: 250px;
}

.photo-rect img, .video-rect video, .graphic-rect img {
    width: 250px; height: 300px; object-fit: cover;
    border: 1px solid rgba(255,255,255,0.3); cursor: zoom-in; transition: 0.3s;
}

.photo-rect img:hover, .video-rect video:hover, .graphic-rect img:hover { border-color: #fff; transform: scale(1.05); }

.media-caption {
    font-size: 10px;
    letter-spacing: 2px;
    text-transform: uppercase;
    font-weight: 700;
    color: rgba(255,255,255,1);
}

.media-description {
    font-size: 9px;
    letter-spacing: 1px;
    color: rgba(255,255,255,0.6);
    text-align: center;
    margin: 0;
    padding: 0 10px;
}

/* LIGHTBOX */
#lightbox {
    position: fixed; top:0; left:0; width:100%; height:100%;
    background: rgba(0,0,0,0.95); z-index: 20000;
    display: none; justify-content: center; align-items: center;
}
#lightboxContent {
    display: flex; flex-direction: column; justify-content: center; align-items: center;
    width: 100%; height: 100%;
}
#lightbox img, #lightbox video { 
    max-width: 90%; max-height: 75%; 
    border: 1px solid #fff; 
    box-shadow: 0 0 30px rgba(0,0,0,0.5);
}
.lightbox-title {
    margin-top: 20px; font-size: 18px; letter-spacing: 4px; font-weight: 700; text-transform: uppercase; color: #fff;
}
#lightbox.active { display: flex; }

/* BOTTONI CHIUSURA */
#p3Close, #closeBtn, #aboutClose, #lightboxClose {
    position: fixed; 
    top: 30px; left: 30px; 
    width: 50px; height: 50px;
    border-radius: 50%; border: 1px solid #fff; background: rgba(0,0,0,0.6);
    color: #fff; cursor: pointer; 
    display: none; justify-content: center; align-items: center; font-size: 24px;
    text-decoration: none;
    z-index: 10002 !important; 
}

#lightboxClose { z-index: 30000 !important; }

#particleCanvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 6000; display: none; background: #000 !important; touch-action: none; }
#particleCanvas.active { display: block; }

/* SEZIONI E GRIGLIA */
section { min-height: 130vh; display: flex; flex-direction: column; justify-content: center; align-items: center; position: relative; z-index: 10; padding: 0 20px; box-sizing: border-box; }
#name { font-size: clamp(30px, 7vw, 60px); letter-spacing: clamp(4px, 1vw, 10px); font-weight: 700; text-transform: uppercase; margin: 0; text-align: center; word-wrap: break-word; max-width: 100%; }
.btn-main { font-weight: 700; font-size: 14px; letter-spacing: 4px; padding: 15px 40px; border: 1px solid #fff; color: #fff; text-decoration: none; transition: .3s; position: relative; z-index: 20; margin-top: 35px; }

.about-container { margin-top: 100px; width: 100%; max-width: 1000px; display: flex; justify-content: center; }
.about-box { text-align: center; }
.about-box p { font-weight: 700; font-size: 12px; letter-spacing: 5px; text-transform: uppercase; color: #ffffff; margin: 8px 0; line-height: 1.5; }

/* GRIGLIA MODIFICATA PER ALLINEAMENTO */
.grid { 
    display: grid; 
    grid-template-columns: repeat(2, 1fr); /* Due colonne uguali */
    gap: 30px; 
    max-width: 1000px; 
    width: 90%; 
    perspective: 1000px; 
}
.item {
    height: 220px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.2);
    backdrop-filter: blur(8px); display: flex; flex-direction: column; justify-content: center; align-items: center; 
    cursor: pointer; transition: transform 0.6s cubic-bezier(0.23, 1, 0.32, 1);
    position: relative; z-index: 20; text-decoration: none; overflow: hidden; color: #fff;
}

/* Stile specifico per Project 3 per centrarlo sotto */
#btnEx3 {
    grid-column: 1 / span 2; /* Occupa lo spazio di entrambe le colonne */
    justify-self: center;    /* Si centra orizzontalmente */
    width: calc(50% - 15px); /* Mantiene la stessa larghezza degli altri (metà meno il gap) */
}

.item::before {
    content: attr(data-num); position: absolute; font-size: 140px; font-weight: 700; color: #fff;
    opacity: 0.08; bottom: -30px; right: -10px; transition: 0.6s; pointer-events: none;
}
.item span { font-size: 12px; letter-spacing: 6px; font-weight: 700; text-transform: uppercase; z-index: 2; }
.item::after { content: '+'; position: absolute; top: 20px; right: 25px; font-size: 20px; }
.item:hover { background: rgba(255, 255, 255, 0.08) !important; transform: translateY(-10px) rotateX(4deg) rotateY(-4deg); }

.contact-links { display: flex; flex-direction: column; gap: 25px; text-align: center; perspective: 1000px; width: 100%; max-width: 100%; }
.big-link { display: inline-block; font-size: clamp(14px, 3.5vw, 32px); color: #fff; text-decoration: none; transition: 0.6s; letter-spacing: 2px; }

@media(max-width: 600px) { 
    .grid { grid-template-columns: 1fr; gap: 20px; } 
    .item { height: 180px; } 
    #btnEx3 { width: 100%; grid-column: auto; } /* Torna normale su mobile */
    .video-rect video, .graphic-rect img, .photo-rect img { width: 180px; height: 220px; } 
}
</style>
</head>
<body>

<canvas id="canvasBG"></canvas>
<div class="scroll-overlay" id="scrollOverlay"></div>

<nav class="navbar" id="mainNav">
    <a href="#home" onclick="closeAll()">Home</a>
    <a href="#exercises" onclick="closeAll()">Projects</a>
    <a href="#contact" onclick="closeAll()">Contact</a>
</nav>

<div id="bgLogo"><img src="logo.png" alt="Logo Sfondo"></div>

<div id="lightboxClose" onclick="closeLightbox()">✕</div>

<div id="lightbox" onclick="closeLightbox()">
    <div id="lightboxContent"></div>
</div>

<div id="aboutOverlay">
    <div class="about-bar-bg"></div>
    <div id="aboutClose" style="display: flex;" onclick="closeAll()">✕</div>
    <div class="about-links">
        
        <div style="text-align: center;">
            <a href="javascript:void(0)" onclick="toggleVideomaking()">Videomaking</a>
            <div id="videoGallery">
                <div class="video-rect">
                    <div class="media-item">
                        <video src="marangoni.mp4" muted onclick="zoomMedia(this, 'video')" data-title="Marangoni"></video>
                        <span class="media-caption">Marangoni (2025)</span>
                        <p class="media-description">Teaser Marangoni Scholarship — Beyond Dimension.</p>
                    </div>
                    <div class="media-item">
                        <video src="show reel.mp4" muted onclick="zoomMedia(this, 'video')" data-title="Show reel"></video>
                        <span class="media-caption">Show reel (2025)</span>
                        <p class="media-description">Showreel — A Year of Visual Storytelling.</p>
                    </div>
                    <div class="media-item">
                        <video src="silent world.mp4" muted onclick="zoomMedia(this, 'video')" data-title="Silent World"></video>
                        <span class="media-caption">Silent World (2025)</span>
                        <p class="media-description">Silent World — Lost in a quiet space.</p>
                    </div>
                    <div class="media-item">
                        <video src="avanguardia.mp4" muted onclick="zoomMedia(this, 'video')" data-title="Avanguardie cinematografiche"></video>
                        <span class="media-caption">Avanguardie cinematografiche (2023)</span>
                        <p class="media-description">Old Cinema Style — Academic Project.</p>
                    </div>
                </div>
            </div>
        </div>

        <div style="text-align: center;">
            <a href="javascript:void(0)" onclick="togglePhotography()">Photography</a>
            <div id="photoGallery">
                <div class="photo-rect">
                    <div class="media-item">
                        <img src="marangoni foto 2.jpg" alt="Marangoni" onclick="zoomMedia(this, 'img')" data-title="Marangoni">
                        <span class="media-caption">Marangoni (2025)</span>
                        <p class="media-description">Beyond Dimension — Marangoni Scholarship</p>
                    </div>
                    <div class="media-item">
                        <img src="food.JPEG" alt="Food Photography" onclick="zoomMedia(this, 'img')" data-title="Food Photography">
                        <span class="media-caption">Food Photography (2025)</span>
                        <p class="media-description">Food Photography & Still Life.</p>
                    </div>
                    <div class="media-item">
                        <img src="lime.jpg" alt="Lime" onclick="zoomMedia(this, 'img')" data-title="Lime">
                        <span class="media-caption">Lime (2024)</span>
                        <p class="media-description">Macro Details — Exploring the unseen.</p>
                    </div>
                    <div class="media-item">
                        <img src="beauty.jpg" alt="Beauty" onclick="zoomMedia(this, 'img')" data-title="Beauty">
                        <span class="media-caption">Beauty (2025)</span>
                        <p class="media-description">Beauty & Light</p>
                    </div>
                </div>
            </div>
        </div>

        <div style="text-align: center;">
            <a href="javascript:void(0)" onclick="toggleGraphic()">Graphic Design</a>
            <div id="graphicGallery">
                <div class="graphic-rect">
                    <div class="media-item">
                        <img src="marangoni.jpg" alt="Marangoni" onclick="zoomMedia(this, 'img')" data-title="Marangoni">
                        <span class="media-caption">Marangoni Locandina (2025)</span>
                        <p class="media-description">Beyond Dimension — Marangoni Scholarship.</p>
                    </div>
                    <div class="media-item">
                        <img src="ballooons.png" alt="Balloons" onclick="zoomMedia(this, 'img')" data-title="Balloons">
                        <span class="media-caption">Balloons (2024)</span>
                        <p class="media-description">Balloons-A tribute to Malika Favre’s minimalism.</p>
                    </div>
                    <div class="media-item">
                        <img src="illustrazione.jpg" alt="Illustration" onclick="zoomMedia(this, 'img')" data-title="Illustration">
                        <span class="media-caption">Illustrazione (2026)</span>
                        <p class="media-description">Beyond the Surface-Negative space and hidden volumes.</p>
                    </div>
                    <div class="media-item">
                        <img src="vip frame.jpg" alt="VIP Frame" onclick="zoomMedia(this, 'img')" data-title="VIP Frame">
                        <span class="media-caption">Vip Frame (2024)</span>
                        <p class="media-description">Evan Peters-Hidden Features — The balance between space and identity.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="closeBtn" onclick="closeAll()">✕</div>
<div id="p3Close" onclick="closeAll()">✕</div>

<canvas id="p3Canvas"></canvas>
<canvas id="particleCanvas"></canvas>

<section id="home">
    <div id="name"></div>
    <a href="#exercises" class="btn-main">EXPLORE</a>
    <div class="about-container">
        <div class="about-box">
            <p>The eye observes. The soul defines.</p>
            <p>The design speaks.</p>
        </div>
    </div>
</section>

<section id="exercises">
    <div class="grid">
        <div class="item" onclick="openAbout()" data-num="01"><span>ABOUT ME</span></div>
        <div class="item" id="btnEx2" data-num="02"><span>PROJECT </span></div>
        <div class="item" id="btnEx3" data-num="03"><span>PROJECT </span></div>
    </div>
</section>

<section id="contact">
    <div style="font-size: 14px; letter-spacing: 10px; margin-bottom: 20px; opacity: 1; text-align: center; font-weight: 700;">CONTACT</div>
    <div class="contact-links">
        <a href="mailto:demigroenendal@gmail.com" class="big-link">demigroenendal@gmail.com</a>
        <a href="https://www.instagram.com/dg.photo.graphy_" target="_blank" class="big-link">@DG.PHOTO.GRAPHY_</a>
    </div>
</section>

<script>
const logoImg = new Image();
logoImg.src = 'logo.png';

function togglePhotography() {
    const g = document.getElementById('photoGallery');
    g.classList.toggle('active');
    document.getElementById('videoGallery').classList.remove('active');
    document.getElementById('graphicGallery').classList.remove('active');
}

function toggleVideomaking() {
    const v = document.getElementById('videoGallery');
    v.classList.toggle('active');
    document.getElementById('photoGallery').classList.remove('active');
    document.getElementById('graphicGallery').classList.remove('active');
}

function toggleGraphic() {
    const gr = document.getElementById('graphicGallery');
    gr.classList.toggle('active');
    document.getElementById('photoGallery').classList.remove('active');
    document.getElementById('videoGallery').classList.remove('active');
}

function zoomMedia(el, type) {
    const lightbox = document.getElementById('lightbox');
    const container = document.getElementById('lightboxContent');
    const closeX = document.getElementById('lightboxClose');
    container.innerHTML = ''; 

    if(type === 'img') {
        const newImg = document.createElement('img');
        newImg.src = el.src;
        container.appendChild(newImg);
    } else if(type === 'video') {
        const newVid = document.createElement('video');
        newVid.src = el.src;
        newVid.controls = true;
        newVid.autoplay = true;
        container.appendChild(newVid);
    }

    const title = el.getAttribute('data-title');
    if(title) {
        const titleEl = document.createElement('div');
        titleEl.className = 'lightbox-title';
        titleEl.textContent = title;
        container.appendChild(titleEl);
    }

    lightbox.classList.add('active');
    closeX.style.display = 'flex'; 
}

function closeLightbox() {
    const lightbox = document.getElementById('lightbox');
    const closeX = document.getElementById('lightboxClose');
    lightbox.classList.remove('active');
    closeX.style.display = 'none'; 
    document.getElementById('lightboxContent').innerHTML = '';
}

function openAbout() {
    document.getElementById('aboutOverlay').classList.add('active');
    document.getElementById('aboutClose').style.display = 'flex';
    document.body.style.overflow = 'hidden';
}

function closeAll() {
    document.body.classList.remove('stop-anim');
    document.getElementById('aboutOverlay').classList.remove('active');
    document.getElementById('aboutClose').style.display = 'none';
    document.getElementById('photoGallery').classList.remove('active');
    document.getElementById('videoGallery').classList.remove('active');
    document.getElementById('graphicGallery').classList.remove('active');
    document.getElementById('lightbox').classList.remove('active');
    document.getElementById('lightboxClose').style.display = 'none';
    p3Canvas.classList.remove('active');
    particleCanvas.classList.remove('active');
    p3Close.style.display = 'none';
    closeBtn.style.display = 'none';
    document.body.style.overflow = 'auto';
}

const bgCanvas = document.getElementById('canvasBG');
const bgCtx = bgCanvas.getContext('2d');
let bgParticles = [];
function initBG() {
    bgCanvas.width = window.innerWidth; bgCanvas.height = window.innerHeight;
    bgParticles = [];
    for(let i=0; i<50; i++) {
        bgParticles.push({ x: Math.random() * bgCanvas.width, y: Math.random() * bgCanvas.height, size: Math.random() * 2, speed: 0.5 + Math.random(), char: Math.random() > 0.5 ? "0" : "1" });
    }
}
function drawBG() {
    bgCtx.clearRect(0,0, bgCanvas.width, bgCanvas.height);
    bgCtx.fillStyle = "rgba(255, 255, 255, 0.15)"; bgCtx.font = "10px monospace";
    bgParticles.forEach(p => { bgCtx.fillText(p.char, p.x, p.y); p.y += p.speed; if(p.y > bgCanvas.height) p.y = -10; });
    requestAnimationFrame(drawBG);
}
window.addEventListener('resize', initBG); initBG(); drawBG();

const nameText = "Demi Groenendal";
const nameDiv = document.getElementById('name');
let idx = 0; let deleting = false;
function typeWriterLoop() {
    if (!deleting) { nameDiv.textContent = nameText.substring(0, idx + 1); idx++; if (idx === nameText.length) { setTimeout(() => { deleting = true; typeWriterLoop(); }, 2000); return; } }
    else { nameDiv.textContent = nameText.substring(0, idx - 1); idx--; if (idx === 0) deleting = false; }
    setTimeout(typeWriterLoop, deleting ? 50 : 150);
}
window.addEventListener('DOMContentLoaded', typeWriterLoop);

const nav = document.getElementById('mainNav');
window.addEventListener('scroll', () => { 
    if (!document.getElementById('aboutOverlay').classList.contains('active')) {
        if (window.pageYOffset > 40) nav.classList.add('hidden'); 
        else nav.classList.remove('hidden'); 
    }
});

const p3Canvas = document.getElementById('p3Canvas');
const p3Ctx = p3Canvas.getContext('2d');
const p3Close = document.getElementById('p3Close');
const btnEx3 = document.getElementById('btnEx3');
let dotsP3 = []; let mouseP3 = { x: -1000, y: -1000 }; let p3Zoom = 1; 

function initP3() {
    p3Canvas.width = window.innerWidth; p3Canvas.height = window.innerHeight; dotsP3 = [];
    const tempCanvas = document.createElement('canvas'); const tempCtx = tempCanvas.getContext('2d');
    let logoW = Math.min(p3Canvas.width * 0.6, 500);
    let logoH = (logoImg.height / logoImg.width) * logoW;
    tempCanvas.width = p3Canvas.width; tempCanvas.height = p3Canvas.height;
    tempCtx.drawImage(logoImg, (tempCanvas.width - logoW)/2, (tempCanvas.height - logoH)/2, logoW, logoH);
    const imgData = tempCtx.getImageData(0, 0, tempCanvas.width, tempCanvas.height).data;
    for (let y = 0; y < tempCanvas.height; y += 5) { 
        for (let x = 0; x < tempCanvas.width; x += 5) { 
            if (imgData[(y * tempCanvas.width + x) * 4 + 3] > 128) { 
                dotsP3.push({ x: p3Canvas.width/2, y: p3Canvas.height/2, baseX: x, baseY: y, vx: 0, vy: 0, size: Math.random() * 2 + 1.5 }); 
            } 
        } 
    }
}
function animateP3() {
    if(!p3Canvas.classList.contains('active')) return; p3Ctx.fillStyle = 'rgba(0,0,0,0.85)'; p3Ctx.fillRect(0, 0, p3Canvas.width, p3Canvas.height);
    dotsP3.forEach(d => {
        const tx = p3Canvas.width/2 + (d.baseX - p3Canvas.width/2) * p3Zoom; const ty = p3Canvas.height/2 + (d.baseY - p3Canvas.height/2) * p3Zoom;
        d.vx += (tx - d.x) * 0.08; d.vy += (ty - d.y) * 0.08;
        let dx = mouseP3.x - d.x; let dy = mouseP3.y - d.y; if(Math.sqrt(dx*dx + dy*dy) < 100) { d.vx -= dx * 0.15; d.vy -= dy * 0.15; }
        d.vx *= 0.8; d.vy *= 0.8; d.x += d.vx; d.y += d.vy;
        p3Ctx.fillStyle = "#fff"; p3Ctx.beginPath(); p3Ctx.arc(d.x, d.y, d.size * Math.min(p3Zoom, 1.5), 0, Math.PI*2); p3Ctx.fill();
    });
    requestAnimationFrame(animateP3);
}
p3Canvas.onwheel = (e) => { e.preventDefault(); p3Zoom += e.deltaY * -0.002; p3Zoom = Math.max(0.1, p3Zoom); };
p3Canvas.addEventListener('mousemove', e => { mouseP3.x = e.clientX; mouseP3.y = e.clientY; });
btnEx3.onclick = e => { e.preventDefault(); document.body.classList.add('stop-anim'); p3Canvas.classList.add('active'); p3Close.style.display='flex'; initP3(); animateP3(); };

const particleCanvas = document.getElementById('particleCanvas');
const ctx = particleCanvas.getContext('2d');
const closeBtn = document.getElementById('closeBtn');
const btnEx2 = document.getElementById('btnEx2');
let particles=[], rotation={x:0,y:0}, targetRotation={x:0,y:0}, zoom=850, isDragging=false, lastPos={x:0,y:0}, isExploded=false, dragDist = 0;

function resizePart(){ particleCanvas.width=window.innerWidth; particleCanvas.height=window.innerHeight; }
window.addEventListener('resize', resizePart); resizePart();

class VectorLine3D{
    constructor(x,y,z,bright){ this.destX=x; this.destY=y; this.destZ=z; this.x=x; this.y=y; this.z=z; this.vx=0; this.vy=0; this.vz=0; this.bright=bright; }
    update(){ 
        if(!isExploded){ this.vx += (this.destX - this.x) * 0.15; this.vy += (this.destY - this.y) * 0.15; this.vz += (this.destZ - this.z) * 0.15; this.vx *= 0.7; this.vy *= 0.7; this.vz *= 0.7; } 
        else { this.vx *= 0.94; this.vy *= 0.94; this.vz *= 0.94; }
        this.x += this.vx; this.y += this.vy; this.z += this.vz; 
    }
    explode(){ const f = 80; this.vx = (Math.random() - 0.5) * f; this.vy = (Math.random() - 0.5) * f; this.vz = (Math.random() - 0.5) * f; }
    draw(){
        let y1 = this.y * Math.cos(rotation.x) - this.z * Math.sin(rotation.x); let z1 = this.y * Math.sin(rotation.x) + this.z * Math.cos(rotation.x);
        let xf = this.x * Math.cos(rotation.y) + z1 * Math.sin(rotation.y); let zf = -this.x * Math.sin(rotation.y) + z1 * Math.cos(rotation.y);
        let sc = 1000 / (zf + zoom);
        if(sc > 0){ ctx.strokeStyle = `rgba(255,255,255,${Math.min(1, (this.bright / 255) + 0.5)})`; ctx.lineWidth = 0.7 * sc; ctx.beginPath(); ctx.moveTo(xf * sc + particleCanvas.width / 2, y1 * sc + particleCanvas.height / 2); ctx.lineTo((xf + 0.5) * sc + particleCanvas.width / 2, (y1 + 0.5) * sc + particleCanvas.height / 2); ctx.stroke(); }
    }
}
const imgP2 = new Image(); imgP2.crossOrigin = "Anonymous"; imgP2.src = 'ritratto.png';
imgP2.onload = () => {
    const tc = document.createElement('canvas'); const tctx = tc.getContext('2d'); tc.width = 400; tc.height = 400;
    tctx.drawImage(imgP2, 0, 0, 400, 400); const data = tctx.getImageData(0, 0, 400, 400).data;
    particles = []; const molt = window.innerWidth < 600 ? 1.6 : 3.2;
    for(let y = 0; y < 400; y += 4){ for(let x = 0; x < 400; x += 4){ const i = (y * 400 + x) * 4; if(data[i + 3] > 128) particles.push(new VectorLine3D((x - 200) * molt, (y - 200) * molt, (data[i] - 128) * 0.6, data[i])); } }
};
function animateP2(){ if(!particleCanvas.classList.contains('active')) return; ctx.clearRect(0, 0, particleCanvas.width, particleCanvas.height); rotation.x += (targetRotation.x - rotation.x) * 0.1; rotation.y += (targetRotation.y - rotation.y) * 0.1; particles.forEach(p => { p.update(); p.draw(); }); requestAnimationFrame(animateP2); }
function startDrag(px, py) { isDragging = true; lastPos = { x: px, y: py }; dragDist = 0; }
function moveDrag(px, py) { if(isDragging){ let dx = px - lastPos.x; let dy = py - lastPos.y; targetRotation.y += dx * 0.01; targetRotation.x += dy * 0.01; lastPos = { x: px, y: py }; dragDist += Math.abs(dx) + Math.abs(dy); } }
function endDrag() { if(isDragging && dragDist < 10){ isExploded = !isExploded; if(isExploded) particles.forEach(p => p.explode()); } isDragging = false; }
particleCanvas.onmousedown = e => startDrag(e.clientX, e.clientY);
window.onmousemove = e => { if(particleCanvas.classList.contains('active')) moveDrag(e.clientX, e.clientY); };
window.onmouseup = () => endDrag();
particleCanvas.addEventListener('wheel', e => { e.preventDefault(); zoom += e.deltaY; });
btnEx2.onclick = e => { e.preventDefault(); document.body.classList.add('stop-anim'); particleCanvas.classList.add('active'); closeBtn.style.display = 'flex'; isExploded = false; animateP2(); };
</script>
</body>
</html>

